<!DOCTYPE html>
<html>
<head>
  <title>Viewer</title>
  <style>
    body, html { margin:0; padding:0; height:100%; overflow:hidden; background:black; }
    video { transform-origin: center center; cursor: grab; }
  </style>
  <script src="https://unpkg.com/peerjs/dist/peerjs.min.js"></script>
</head>
<body>
  <video id="video" autoplay playsinline></video>
  <script>
    const peer = new Peer();
    const video = document.getElementById('video');
    let scale = 1, offsetX = 0, offsetY = 0;

    peer.on('open', id => {
      const call = peer.call("studyroom-host-unique-2025", null); // fixed host ID
      call.on('stream', stream => {
        video.srcObject = stream;
        video.style.width = "100%";
        video.style.height = "100%";
      });
    });

    // Zoom/pan controls
    function applyTransform() {
      video.style.transform = `translate(${offsetX}px, ${offsetY}px) scale(${scale})`;
    }

    document.addEventListener('keydown', e => {
      if (e.key === '+') { scale *= 1.1; applyTransform(); }
      if (e.key === '-') { scale /= 1.1; applyTransform(); }
      if (e.key.toLowerCase() === 'f') { // fullscreen shortcut
        if (!document.fullscreenElement) video.requestFullscreen();
        else document.exitFullscreen();
      }
    });

    video.addEventListener('wheel', e => {
      e.preventDefault();
      scale *= e.deltaY < 0 ? 1.1 : 0.9;
      applyTransform();
    });

    video.addEventListener('dblclick', () => {
      scale = 1; offsetX = 0; offsetY = 0; applyTransform();
    });

    // Dragging
    let dragging = false, startX, startY;
    video.addEventListener('mousedown', e => {
      dragging = true; startX = e.clientX; startY = e.clientY;
      video.style.cursor = "grabbing";
    });
    document.addEventListener('mouseup', () => { dragging = false; video.style.cursor = "grab"; });
    document.addEventListener('mousemove', e => {
      if (dragging) {
        offsetX += e.clientX - startX;
        offsetY += e.clientY - startY;
        startX = e.clientX; startY = e.clientY;
        applyTransform();
      }
    });

    // Touch pinch/drag
    let lastDist = null;
    video.addEventListener('touchmove', e => {
      if (e.touches.length === 2) {
        const dx = e.touches[0].clientX - e.touches[1].clientX;
        const dy = e.touches[0].clientY - e.touches[1].clientY;
        const dist = Math.sqrt(dx*dx + dy*dy);
        if (lastDist) {
          scale *= dist / lastDist;
          applyTransform();
        }
        lastDist = dist;
      } else if (e.touches.length === 1) {
        offsetX += e.touches[0].movementX || 0;
        offsetY += e.touches[0].movementY || 0;
        applyTransform();
      }
    });
    video.addEventListener('touchend', () => { lastDist = null; });
  </script>
</body>
</html>