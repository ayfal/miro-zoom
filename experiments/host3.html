<!DOCTYPE html>
<html>
<head>
  <title>Host</title>
  <script src="https://unpkg.com/peerjs/dist/peerjs.min.js"></script>
</head>
<body>
  <h2>Host Screen Share</h2>
  <p>Fixed ID: studyroom-host-unique-2025</p>
  <script>
    const peer = new Peer("studyroom-host-unique-2025"); // fixed ID

    async function startShare() {
      try {
        // Prompt for screen + mic
        const screenStream = await navigator.mediaDevices.getDisplayMedia({ video: true });
        const micStream = await navigator.mediaDevices.getUserMedia({ audio: true });

        // Merge mic audio into screen stream
        micStream.getAudioTracks().forEach(track => screenStream.addTrack(track));

        // When a viewer calls, send them the stream
        peer.on('call', call => {
          call.answer(screenStream); // send hostâ€™s screen+mic
          
          // Suppress feedback: don't play viewer audio back
          call.on('stream', remoteStream => {
            console.log("Viewer audio received but not played to avoid echo");
            // If you want to monitor viewer audio quietly:
            // const audio = new Audio();
            // audio.srcObject = remoteStream;
            // audio.volume = 0.1; // very low volume
            // audio.play();
          });
        });

        console.log("Screen sharing started");
      } catch (err) {
        console.error("Permission denied or error:", err);
      }
    }

    startShare();
  </script>
</body>
</html>