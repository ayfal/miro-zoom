<!DOCTYPE html>
<html>
<head>
  <title>Host</title>
  <script src="https://unpkg.com/peerjs/dist/peerjs.min.js"></script>
</head>
<body>
  <h2>Host Screen Share</h2>
  <p>Fixed ID: studyroom-host-unique-2025</p>
  <script>
    const peer = new Peer("studyroom-host-unique-2025"); // fixed ID
    let micTrack; // to toggle mute/unmute later

    async function startShare() {
      try {
        // Prompt for screen + mic
        const screenStream = await navigator.mediaDevices.getDisplayMedia({ video: true });
        const micStream = await navigator.mediaDevices.getUserMedia({ audio: true });

        // Save mic track for mute/unmute
        micTrack = micStream.getAudioTracks()[0];

        // Merge mic audio into screen stream
        screenStream.addTrack(micTrack);

        // When a viewer calls, send them the stream
        peer.on('call', call => {
          call.answer(screenStream); // send hostâ€™s screen+mic
          call.on('close', () => console.log("Viewer disconnected"));
        });

        console.log("Screen + mic sharing started");
      } catch (err) {
        console.error("Permission denied or error:", err);
      }
    }

    startShare();

    // Mute/unmute hotkey
    document.addEventListener('keydown', e => {
      if (e.key.toLowerCase() === 'm' && micTrack) {
        micTrack.enabled = !micTrack.enabled;
        console.log("Mic " + (micTrack.enabled ? "unmuted" : "muted"));
      }
    });
  </script>
</body>
</html>