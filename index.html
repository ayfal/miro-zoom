<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Mirotalk Zoom/Pan Bookmarklet</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial; padding:20px; background:#f7f7f7; }
    a.bookmarklet { display:inline-block; padding:12px 18px; background:#0366d6; color:#fff; text-decoration:none; border-radius:6px; }
    p.small{ color:#444; margin-top:12px; }
  </style>
</head>
<body>
  <h1>Mirotalk Zoom/Pan Bookmarklet</h1>
  <p>Drag this link to your bookmarks toolbar. After the screen-share has started in Mirotalk, click the bookmark to isolate the shared video and enable zoom/pan.</p>

  <a class="bookmarklet"
     href="javascript:(function(){try{const v=document.querySelector('video[id$=&quot;___screen&quot;]');if(!v){alert('Screen video not found (run after screen-share starts).');return;}const container=document.createElement('div');container.style.position='fixed';container.style.inset='0';container.style.background='#000';container.style.zIndex=2147483647;container.style.overflow='hidden';container.style.touchAction='none';const restore={parent:v.parentNode,next:v.nextSibling};container._restore=restore;v.style.position='absolute';v.style.left='50%';v.style.top='50%';v.style.transform='translate(-50%,-50%) scale(1)';v.style.transformOrigin='center center';v.style.maxWidth='none';v.style.maxHeight='none';v.style.width='auto';v.style.height='auto';v.style.objectFit='contain';v.style.cursor='grab';document.body.innerHTML='';document.body.appendChild(container);container.appendChild(v);let scale=1,originX=0,originY=0,lastX=0,lastY=0,dragging=false,startX, startY;function updateTransform(){v.style.transform=`translate(calc(-50% + ${originX}px), calc(-50% + ${originY}px)) scale(${scale})`;}container.addEventListener('wheel',function(e){e.preventDefault();const delta=-e.deltaY;const zoomFactor=Math.exp(delta*0.0015);const rect=v.getBoundingClientRect();const cx=e.clientX-rect.left;const cy=e.clientY-rect.top;const dx=(cx-rect.width/2);const dy=(cy-rect.height/2);originX-=dx*(zoomFactor-1);originY-=dy*(zoomFactor-1);scale=Math.min(Math.max(scale*zoomFactor,0.5),5);updateTransform();},{passive:false});container.addEventListener('pointerdown',function(e){e.preventDefault();dragging=true;startX=e.clientX;startY=e.clientY;lastX=originX;lastY=originY;container.setPointerCapture(e.pointerId);v.style.cursor='grabbing';});container.addEventListener('pointermove',function(e){if(!dragging) return;originX=lastX+(e.clientX-startX);originY=lastY+(e.clientY-startY);updateTransform();});container.addEventListener('pointerup',function(e){dragging=false;v.style.cursor='grab';});container.addEventListener('pointercancel',function(e){dragging=false;v.style.cursor='grab';});let touchState=null;container.addEventListener('touchstart',function(e){if(e.touches.length===2){touchState={a:{x:e.touches[0].clientX,y:e.touches[0].clientY},b:{x:e.touches[1].clientX,y:e.touches[1].clientY},scale}}else if(e.touches.length===1){touchState={panStart:{x:e.touches[0].clientX,y:e.touches[0].clientY},lastX:originX,lastY:originY}}},{passive:false});container.addEventListener('touchmove',function(e){e.preventDefault();if(e.touches.length===2&&touchState&&touchState.a){const a={x:e.touches[0].clientX,y:e.touches[0].clientY};const b={x:e.touches[1].clientX,y:e.touches[1].clientY};const d0=Math.hypot(touchState.a.x-touchState.b.x,touchState.a.y-touchState.b.y);const d1=Math.hypot(a.x-b.x,a.y-b.y);const factor=d1/d0;scale=Math.min(Math.max(touchState.scale*factor,0.5),5);updateTransform();}else if(e.touches.length===1&&touchState&&touchState.panStart){originX=touchState.lastX+(e.touches[0].clientX-touchState.panStart.x);originY=touchState.lastY+(e.touches[0].clientY-touchState.panStart.y);updateTransform();}}, {passive:false});container.addEventListener('touchend',function(e){if(e.touches.length===0) touchState=null;},{passive:false});container.addEventListener('dblclick',function(){scale=1;originX=0;originY=0;updateTransform();});function restorePage(){try{if(container._restore&&container._restore.parent){container._restore.parent.insertBefore(v,container._restore.next);}else document.body.appendChild(v);location.reload();}catch(e){location.reload();}}document.addEventListener('keydown',function(e){if(e.key==='Escape') restorePage();});if(container.requestFullscreen) container.requestFullscreen().catch(()=>{});}catch(err){alert('Bookmarklet error: '+err.message);}})();">
    MiroZoom
  </a>

<p class="small">Usage: join the Mirotalk <a href="https://p2p.mirotalk.com/" target="_blank" rel="noopener noreferrer">p2p.mirotalk.com</a> room, wait for the other user to start sharing, then click the bookmark. Use mouse wheel to zoom, drag to pan, double-click to reset, Esc to restore (or reload).</p>
</body>
</html>